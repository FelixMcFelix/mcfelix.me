function earcut(e,t,r){r=r||2;var n=t&&t.length,a=n?t[0]*r:e.length,s=filterPoints(e,linkedList(e,0,a,r,!0)),o=[];if(!s)return o;var i,c,h,u,l,d,p;if(n&&(s=eliminateHoles(e,t,s,r)),e.length>80*r){i=h=e[0],c=u=e[1];for(var S=r;a>S;S+=r)l=e[S],d=e[S+1],i>l&&(i=l),c>d&&(c=d),l>h&&(h=l),d>u&&(u=d);p=Math.max(h-i,u-c)}return earcutLinked(e,s,o,r,i,c,p),o}function linkedList(e,t,r,n,a){var s,o,i,c=0;for(s=t,o=r-n;r>s;s+=n)c+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;if(a===c>0)for(s=t;r>s;s+=n)i=insertNode(s,i);else for(s=r-n;s>=t;s-=n)i=insertNode(s,i);return i}function filterPoints(e,t,r){r||(r=t);var n,a=t;do if(n=!1,a.steiner||!equals(e,a.i,a.next.i)&&0!==orient(e,a.prev.i,a.i,a.next.i))a=a.next;else{if(a.prev.next=a.next,a.next.prev=a.prev,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ),a=r=a.prev,a===a.next)return null;n=!0}while(n||a!==r);return r}function earcutLinked(e,t,r,n,a,s,o,i){if(t){i||void 0===a||indexCurve(e,t,a,s,o);for(var c,h,u=t;t.prev!==t.next;)if(c=t.prev,h=t.next,isEar(e,t,a,s,o))r.push(c.i/n),r.push(t.i/n),r.push(h.i/n),h.prev=c,c.next=h,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ),t=h.next,u=h.next;else if(t=h,t===u){i?1===i?(t=cureLocalIntersections(e,t,r,n),earcutLinked(e,t,r,n,a,s,o,2)):2===i&&splitEarcut(e,t,r,n,a,s,o):earcutLinked(e,filterPoints(e,t),r,n,a,s,o,1);break}}}function isEar(e,t,r,n,a){var s=t.prev.i,o=t.i,i=t.next.i,c=e[s],h=e[s+1],u=e[o],l=e[o+1],d=e[i],p=e[i+1],S=c*l-h*u,k=c*p-h*d,f=d*l-p*u,g=S-k-f;if(0>=g)return!1;var m,y,v,b,N,O,P,M=p-h,A=c-d,_=h-l,E=u-c;if(void 0!==r){var x=u>c?d>c?c:d:d>u?u:d,T=l>h?p>h?h:p:p>l?l:p,G=c>u?c>d?c:d:u>d?u:d,I=h>l?h>p?h:p:l>p?l:p,L=zOrder(x,T,r,n,a),C=zOrder(G,I,r,n,a);for(P=t.nextZ;P&&P.z<=C;)if(m=P.i,P=P.nextZ,m!==s&&m!==i&&(y=e[m],v=e[m+1],b=M*y+A*v-k,b>=0&&(N=_*y+E*v+S,N>=0&&(O=g-b-N,O>=0&&(b&&N||b&&O||N&&O)))))return!1;for(P=t.prevZ;P&&P.z>=L;)if(m=P.i,P=P.prevZ,m!==s&&m!==i&&(y=e[m],v=e[m+1],b=M*y+A*v-k,b>=0&&(N=_*y+E*v+S,N>=0&&(O=g-b-N,O>=0&&(b&&N||b&&O||N&&O)))))return!1}else for(P=t.next.next;P!==t.prev;)if(m=P.i,P=P.next,y=e[m],v=e[m+1],b=M*y+A*v-k,b>=0&&(N=_*y+E*v+S,N>=0&&(O=g-b-N,O>=0&&(b&&N||b&&O||N&&O))))return!1;return!0}function cureLocalIntersections(e,t,r,n){var a=t;do{var s=a.prev,o=a.next.next;if(s.i!==o.i&&intersects(e,s.i,a.i,a.next.i,o.i)&&locallyInside(e,s,o)&&locallyInside(e,o,s)){r.push(s.i/n),r.push(a.i/n),r.push(o.i/n),s.next=o,o.prev=s;var i=a.prevZ,c=a.nextZ&&a.nextZ.nextZ;i&&(i.nextZ=c),c&&(c.prevZ=i),a=t=o}a=a.next}while(a!==t);return a}function splitEarcut(e,t,r,n,a,s,o){var i=t;do{for(var c=i.next.next;c!==i.prev;){if(i.i!==c.i&&isValidDiagonal(e,i,c)){var h=splitPolygon(i,c);return i=filterPoints(e,i,i.next),h=filterPoints(e,h,h.next),earcutLinked(e,i,r,n,a,s,o),void earcutLinked(e,h,r,n,a,s,o)}c=c.next}i=i.next}while(i!==t)}function eliminateHoles(e,t,r,n){var a,s,o,i,c,h=[];for(a=0,s=t.length;s>a;a++)o=t[a]*n,i=s-1>a?t[a+1]*n:e.length,c=linkedList(e,o,i,n,!1),c===c.next&&(c.steiner=!0),c=filterPoints(e,c),c&&h.push(getLeftmost(e,c));for(h.sort(function(t,r){return e[t.i]-e[r.i]}),a=0;a<h.length;a++)eliminateHole(e,h[a],r),r=filterPoints(e,r,r.next);return r}function eliminateHole(e,t,r){if(r=findHoleBridge(e,t,r)){var n=splitPolygon(r,t);filterPoints(e,n,n.next)}}function findHoleBridge(e,t,r){var n,a,s,o=r,i=t.i,c=e[i],h=e[i+1],u=-(1/0);do{if(a=o.i,s=o.next.i,h<=e[a+1]&&h>=e[s+1]){var l=e[a]+(h-e[a+1])*(e[s]-e[a])/(e[s+1]-e[a+1]);c>=l&&l>u&&(u=l,n=e[a]<e[s]?o:o.next)}o=o.next}while(o!==r);if(!n)return null;var d,p,S,k,f,g,m=e[n.i],y=e[n.i+1],v=c*y-h*m,b=c*h-h*u,N=h-h,O=c-u,P=h-y,M=m-c,A=v-b-(u*y-h*m),_=0>=A?-1:1,E=n,x=1/0;for(o=n.next;o!==E;)d=e[o.i],p=e[o.i+1],S=c-d,S>=0&&d>=m&&(k=(N*d+O*p-b)*_,k>=0&&(f=(P*d+M*p+v)*_,f>=0&&A*_-k-f>=0&&(g=Math.abs(h-p)/S,x>g&&locallyInside(e,o,t)&&(n=o,x=g)))),o=o.next;return n}function indexCurve(e,t,r,n,a){var s=t;do null===s.z&&(s.z=zOrder(e[s.i],e[s.i+1],r,n,a)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,sortLinked(s)}function sortLinked(e){var t,r,n,a,s,o,i,c,h=1;do{for(r=e,e=null,s=null,o=0;r;){for(o++,n=r,i=0,t=0;h>t&&(i++,n=n.nextZ,n);t++);for(c=h;i>0||c>0&&n;)0===i?(a=n,n=n.nextZ,c--):0!==c&&n?r.z<=n.z?(a=r,r=r.nextZ,i--):(a=n,n=n.nextZ,c--):(a=r,r=r.nextZ,i--),s?s.nextZ=a:e=a,a.prevZ=s,s=a;r=n}s.nextZ=null,h*=2}while(o>1);return e}function zOrder(e,t,r,n,a){return e=1e3*(e-r)/a,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t=1e3*(t-n)/a,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1}function getLeftmost(e,t){var r=t,n=t;do e[r.i]<e[n.i]&&(n=r),r=r.next;while(r!==t);return n}function isValidDiagonal(e,t,r){return t.next.i!==r.i&&t.prev.i!==r.i&&!intersectsPolygon(e,t,t.i,r.i)&&locallyInside(e,t,r)&&locallyInside(e,r,t)&&middleInside(e,t,t.i,r.i)}function orient(e,t,r,n){var a=(e[r+1]-e[t+1])*(e[n]-e[r])-(e[r]-e[t])*(e[n+1]-e[r+1]);return a>0?1:0>a?-1:0}function equals(e,t,r){return e[t]===e[r]&&e[t+1]===e[r+1]}function intersects(e,t,r,n,a){return orient(e,t,r,n)!==orient(e,t,r,a)&&orient(e,n,a,t)!==orient(e,n,a,r)}function intersectsPolygon(e,t,r,n){var a=t;do{var s=a.i,o=a.next.i;if(s!==r&&o!==r&&s!==n&&o!==n&&intersects(e,s,o,r,n))return!0;a=a.next}while(a!==t);return!1}function locallyInside(e,t,r){return-1===orient(e,t.prev.i,t.i,t.next.i)?-1!==orient(e,t.i,r.i,t.next.i)&&-1!==orient(e,t.i,t.prev.i,r.i):-1===orient(e,t.i,r.i,t.prev.i)||-1===orient(e,t.i,t.next.i,r.i)}function middleInside(e,t,r,n){var a=t,s=!1,o=(e[r]+e[n])/2,i=(e[r+1]+e[n+1])/2;do{var c=a.i,h=a.next.i;e[c+1]>i!=e[h+1]>i&&o<(e[h]-e[c])*(i-e[c+1])/(e[h+1]-e[c+1])+e[c]&&(s=!s),a=a.next}while(a!==t);return s}function splitPolygon(e,t){var r=new Node(e.i),n=new Node(t.i),a=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=a,a.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function insertNode(e,t){var r=new Node(e);return t?(r.next=t.next,r.prev=t,t.next.prev=r,t.next=r):(r.prev=r,r.next=r),r}function Node(e){this.i=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Sketch=Sketch||{};Sketch.createSketch=function(e){var t=new Sketch.Driver(e);return t.addShaderURL("shaders/sketch-default.json"),t},Sketch.Driver=function(e){this.readyLock=0,this.canvas=e,this.context=e.getContext("webgl",{preserveDrawingBuffer:!0}),this.parser=sketchParse,this.codeGen=null,this.shaderManager=new Palette.Manager(this.context),this.vm=null},Sketch.Driver.prototype={addShader:function(e){this.readyLock++,this.addShaderInternal(e)},addShaderURL:function(e){this.readyLock++;var t=this,r=new XMLHttpRequest;r.open("GET",e,!0),r.onload=function(){t.addShaderInternal(r.responseText)},r.send()},addShaderInternal:function(e){this.shaderManager.addShader(e),this.readyLock--},compile:function(e){if(this.readyLock>0)return alert("Sketch driver is still loading shaders - be patient! If it's been excessively long then you may have tried to add a malformed shader."),!1;this.vm&&this.vm.kill(),this.vm=null,this.codeGen=null;try{this.codeGen=new Sketch.SketchGen;var t=this.parser.parse(e),r=this.codeGen.interpret(t),n=new MVM.VM(this.context,this.shaderManager,r.code,!1);this.vm=n;var a=this.vm.interpret();null!==r.initAddr&&this.vm.call(r.initAddr,[]);var s=Date.now();if(null!==r.renderAddr){var o=this,i=function(){if(!n.dead){n.call(r.renderAddr,[Date.now()-s]);window.requestAnimationFrame(i,o.canvas)}};window.requestAnimationFrame(i,this.canvas)}console.log(a)}catch(c){return alert("Error detected while rendering! See console for stack trace."),console.log(c),!1}return!0}};var sketchParse=function(){function e(){this.yy={}}var t=function(e,t,r,n){for(r=r||{},n=e.length;n--;r[e[n]]=t);return r},r=[1,8],n=[1,41],a=[1,20],s=[1,12],o=[1,28],i=[1,29],c=[1,21],h=[1,22],u=[1,23],l=[1,24],d=[1,25],p=[1,26],S=[1,27],k=[1,19],f=[1,36],g=[1,37],m=[1,38],y=[1,39],v=[1,40],b=[1,42],N=[1,43],O=[1,30],P=[1,31],M=[1,32],A=[1,33],_=[1,34],E=[1,35],x=[5,10,21,25,29,34,35,36,39,40,41,42,43,44,47,67,68,69,70,71,73,74,77,78,79,80,81,82],T=[1,47],G=[5,10,21,25,26,29,34,35,36,39,40,41,42,43,44,47,67,68,69,70,71,73,74,77,78,79,80,81,82],I=[2,87],L=[1,50],C=[5,10,21,25,26,29,34,35,36,39,40,41,42,43,44,67,68,69,70,71,73,74,77,78,79,80,81,82],w=[1,58],R=[1,52],D=[1,53],V=[1,54],F=[1,55],U=[1,56],$=[1,57],B=[5,10,19,21,22,24,25,26,29,34,35,36,39,40,41,42,43,44,46,47,48,49,50,66,67,68,69,70,71,73,74,75,77,78,79,80,81,82],Z=[1,77],H=[2,93],z=[1,78],q=[5,10,26,29,34,35,36,39,40,41,42,43,44,77,78,79,80,81,82],J=[25,67],W=[5,10,16,19,21,22,24,25,26,29,34,35,36,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,73,74,75,77,78,79,80,81,82],X=[22,24],j=[5,10,16,21,22,24,25,26,29,34,35,36,39,40,41,42,43,44,47,67,68,69,70,71,73,74,75,77,78,79,80,81,82],K=[5,10,21,25,26,29,34,35,36,39,40,41,42,43,44,47,67,68,69,70,71,73,74,75,77,78,79,80,81,82],Y=[5,10,21,22,24,25,26,29,34,35,36,39,40,41,42,43,44,46,47,48,49,66,67,68,69,70,71,73,74,75,77,78,79,80,81,82],Q=[5,10,21,25,26,29,34,35,36,38,39,40,41,42,43,44,47,67,68,69,70,71,73,74,77,78,79,80,81,82],ee=[1,134],te=[10,21,25,26,29,34,35,36,39,40,41,42,43,44,47,67,68,69,70,71,73,74,77,78,79,80,81,82],re=[2,91],ne=[5,10,21,22,24,25,26,29,34,35,36,39,40,41,42,43,44,46,47,66,67,68,69,70,71,73,74,75,77,78,79,80,81,82],ae=[5,10,21,22,24,25,26,29,34,35,36,39,40,41,42,43,44,67,68,69,70,71,73,74,75,77,78,79,80,81,82],se=[22,24,26],oe=[1,159],ie=[19,25],ce=[2,35],he=[1,169],ue={trace:function(){},yy:{},symbols_:{error:2,start:3,program:4,EOF:5,declarations:6,"out-decl":7,"in-decl":8,statement:9,FUNCTION:10,declarator:11,declaration_list:12,func_return:13,body:14,param:15,ASSIGN:16,exp:17,semi:18,ARROW:19,type:20,OPEN_PARENS:21,CLOSE_PARENS:22,param_list:23,COMMA:24,OPEN_BRACE:25,CLOSE_BRACE:26,statement_list:27,decl_list:28,"function":29,condition_statements:30,iteration_statements:31,jump_statements:32,render_statements:33,CLEAR:34,DRAW:35,IF:36,else_ifs:37,ELSE:38,WHILE:39,DO:40,FOR:41,CONTINUE:42,BREAK:43,RETURN:44,prim_expr:45,PLUS:46,MINUS:47,MULT:48,DIV:49,MODULO:50,OP_ADD_ASSIGNMENT:51,OP_SUB_ASSIGNMENT:52,OP_MULT_ASSIGNMENT:53,OP_DIV_ASSIGNMENT:54,OP_MOD_ASSIGNMENT:55,OP_INC:56,OP_DEC:57,OP_AND:58,OP_OR:59,OP_EQ:60,LT:61,GT:62,OP_NE:63,OP_LE:64,OP_GE:65,TILDE:66,IDENTIFIER:67,NUMBER:68,TRUE:69,FALSE:70,EXCL:71,init_list:72,WIDTH:73,HEIGHT:74,SEMICOLON:75,declaration:76,VOID:77,NUM:78,BOOL:79,POINT:80,LINE:81,POLYGON:82,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",10:"FUNCTION",16:"ASSIGN",19:"ARROW",21:"OPEN_PARENS",22:"CLOSE_PARENS",24:"COMMA",25:"OPEN_BRACE",26:"CLOSE_BRACE",29:"function",34:"CLEAR",35:"DRAW",36:"IF",38:"ELSE",39:"WHILE",40:"DO",41:"FOR",42:"CONTINUE",43:"BREAK",44:"RETURN",46:"PLUS",47:"MINUS",48:"MULT",49:"DIV",50:"MODULO",51:"OP_ADD_ASSIGNMENT",52:"OP_SUB_ASSIGNMENT",53:"OP_MULT_ASSIGNMENT",54:"OP_DIV_ASSIGNMENT",55:"OP_MOD_ASSIGNMENT",56:"OP_INC",57:"OP_DEC",58:"OP_AND",59:"OP_OR",60:"OP_EQ",61:"LT",62:"GT",63:"OP_NE",64:"OP_LE",65:"OP_GE",66:"TILDE",67:"IDENTIFIER",68:"NUMBER",69:"TRUE",70:"FALSE",71:"EXCL",73:"WIDTH",74:"HEIGHT",75:"SEMICOLON",77:"VOID",78:"NUM",79:"BOOL",80:"POINT",81:"LINE",82:"POLYGON"},productions_:[0,[3,2],[3,1],[4,1],[4,2],[6,1],[6,1],[6,1],[7,5],[8,4],[8,2],[13,2],[13,0],[12,2],[12,3],[23,1],[23,3],[15,2],[14,2],[14,3],[14,3],[14,4],[9,2],[9,1],[9,1],[9,1],[9,1],[9,1],[9,1],[33,2],[33,3],[33,3],[30,6],[37,7],[37,2],[37,0],[31,5],[31,7],[31,9],[32,2],[32,2],[32,3],[32,2],[28,1],[28,1],[28,2],[28,2],[27,1],[27,2],[27,2],[17,1],[17,3],[17,3],[17,3],[17,3],[17,3],[17,3],[17,3],[17,3],[17,3],[17,3],[17,2],[17,2],[17,3],[17,3],[17,3],[17,3],[17,3],[17,3],[17,3],[17,3],[17,3],[17,3],[17,3],[17,2],[45,1],[45,1],[45,1],[45,1],[45,2],[45,3],[45,4],[45,3],[45,3],[45,1],[45,1],[18,1],[18,0],[11,1],[76,1],[76,4],[72,1],[72,3],[72,0],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1]],performAction:function(e,t,r,n,a,s,o){var i=s.length-1;switch(a){case 1:return"undefined"!=typeof console?console.log("%j",s[i-1]):print(s[i-1]),s[i-1];case 2:return[];case 4:this.$=[s[i-1],s[i]];break;case 8:this.$={type:Sketch.SketchGenNodes["function"],arguments:[s[i-3],s[i-2],s[i-1],s[i]]};break;case 9:this.$={type:Sketch.SketchGenNodes.variable_decl_assign,arguments:[s[i-3],s[i-1]]};break;case 10:this.$={type:Sketch.SketchGenNodes.variable_decl,arguments:s[i-1]};break;case 11:this.$=s[i];break;case 12:this.$="void";break;case 13:this.$=[];break;case 14:this.$=s[i-1];break;case 15:this.$=[s[i]];break;case 16:this.$=s[i-2],this.$.push(s[i]);break;case 17:this.$={type:Sketch.SketchGenNodes.decl,arguments:[s[i-1],s[i]]};break;case 18:this.$={type:Sketch.SketchGenNodes.block,arguments:[]};break;case 19:case 20:this.$={type:Sketch.SketchGenNodes.block,arguments:s[i-1]};break;case 21:this.$={type:Sketch.SketchGenNodes.block,arguments:[s[i-2],s[i-1]]};break;case 29:this.$={type:Sketch.SketchGenNodes.clear,arguments:null};break;case 30:this.$={type:Sketch.SketchGenNodes.clear_colour,arguments:s[i-1]};break;case 31:this.$={type:Sketch.SketchGenNodes.draw,arguments:s[i-1]};break;case 32:this.$={type:Sketch.SketchGenNodes["if"],arguments:[{type:Sketch.SketchGenNodes.else_if,arguments:[s[i-3],s[i-1]]}].concat(s[i])};break;case 33:this.$=s[i],this.$.unshift({type:Sketch.SketchGenNodes.else_if,arguments:[s[i-3],s[i-1]]});break;case 34:this.$=[{type:Sketch.SketchGenNodes["else"],arguments:s[i]}];break;case 35:case 93:this.$=[];break;case 36:this.$={type:"while",arguments:[s[i-2],s[i-1]]};break;case 37:this.$={type:"do_while",arguments:[s[i-5],s[i-2]]};break;case 38:this.$={type:"for",arguments:[s[i-6],s[i-4],s[i-2],s[i]]};break;case 41:this.$={type:Sketch.SketchGenNodes["return"],arguments:s[i-1]};break;case 42:this.$={type:Sketch.SketchGenNodes["return"],arguments:null};break;case 45:case 46:this.$=[s[i-1],s[i]];break;case 47:this.$=[s[i]];break;case 48:case 49:this.$=s[i-1],this.$.push(s[i]);break;case 51:this.$={type:Sketch.SketchGenNodes.addition,arguments:[s[i-2],s[i]]};break;case 52:this.$={type:Sketch.SketchGenNodes.subtraction,arguments:[s[i-2],s[i]]};break;case 53:this.$={type:Sketch.SketchGenNodes.multiplication,arguments:[s[i-2],s[i]]};break;case 54:this.$={type:Sketch.SketchGenNodes.division,arguments:[s[i-2],s[i]]};break;case 55:this.$={type:Sketch.SketchGenNodes.modulo,arguments:[s[i-2],s[i]]};break;case 56:this.$={type:Sketch.SketchGenNodes.add_assign,arguments:[s[i-2],s[i]]};break;case 57:this.$={type:Sketch.SketchGenNodes.sub_assign,arguments:[s[i-2],s[i]]};break;case 58:this.$={type:Sketch.SketchGenNodes.mul_assign,arguments:[s[i-2],s[i]]};break;case 59:this.$={type:Sketch.SketchGenNodes.div_assign,arguments:[s[i-2],s[i]]};break;case 60:this.$={type:Sketch.SketchGenNodes.mod_assign,arguments:[s[i-2],s[i]]};break;case 61:this.$={type:Sketch.SketchGenNodes.increment,arguments:[s[i-1]]};break;case 62:this.$={type:Sketch.SketchGenNodes.decrement,arguments:[s[i-1]]};break;case 63:this.$={type:Sketch.SketchGenNodes.and,arguments:[s[i-2],s[i]]};break;case 64:this.$={type:Sketch.SketchGenNodes.or,arguments:[s[i-2],s[i]]};break;case 65:this.$={type:Sketch.SketchGenNodes.equal,arguments:[s[i-2],s[i]]};break;case 66:this.$={type:Sketch.SketchGenNodes.less_than,arguments:[s[i-2],s[i]]};break;case 67:this.$={type:Sketch.SketchGenNodes.greater_than,arguments:[s[i-2],s[i]]};break;case 68:this.$={type:Sketch.SketchGenNodes.not_equal,arguments:[s[i-2],s[i]]};break;case 69:this.$={type:Sketch.SketchGenNodes.less_than_or_equal,arguments:[s[i-2],s[i]]};break;case 70:this.$={type:Sketch.SketchGenNodes.greater_than_or_equal,arguments:[s[i-2],s[i]]};break;case 71:this.$={type:Sketch.SketchGenNodes.assign,arguments:[s[i-2],s[i]]};break;case 72:this.$={type:Sketch.SketchGenNodes.colour,arguments:[s[i-2],s[i]]};break;case 73:this.$={type:Sketch.SketchGenNodes.translate,arguments:[s[i-2],s[i]]};break;case 74:this.$={type:Sketch.SketchGenNodes.unary_minus,arguments:s[i]};break;case 75:this.$={type:Sketch.SketchGenNodes.ident,arguments:e};break;case 76:this.$={type:Sketch.SketchGenNodes.num,arguments:Number(e)};break;case 77:this.$={type:Sketch.SketchGenNodes.bool,arguments:!0};break;case 78:this.$={type:Sketch.SketchGenNodes.bool,arguments:!1};break;case 79:this.$={type:Sketch.SketchGenNodes.negate,arguments:s[i]};break;case 80:case 83:this.$=s[i-1];break;case 81:this.$={type:Sketch.SketchGenNodes.func_call,arguments:[s[i-3],s[i-1]]};break;case 82:this.$={type:Sketch.SketchGenNodes.point,arguments:s[i-1]};break;case 84:this.$={type:Sketch.SketchGenNodes.width,arguments:null};break;case 85:this.$={type:Sketch.SketchGenNodes.height,arguments:null};break;case 90:this.$=[s[i-3],s[i-1]];break;case 91:this.$=[s[i]];break;case 92:this.$=s[i-2],this.$.push(s[i])}},table:[{3:1,4:2,5:[1,3],6:4,7:5,8:6,9:7,10:r,14:11,15:9,17:10,20:17,21:n,25:a,29:s,30:13,31:14,32:15,33:16,34:o,35:i,36:c,39:h,40:u,41:l,42:d,43:p,44:S,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N,77:O,78:P,79:M,80:A,81:_,82:E},{1:[3]},{5:[1,44],6:45,7:5,8:6,9:7,10:r,14:11,15:9,17:10,20:17,21:n,25:a,29:s,30:13,31:14,32:15,33:16,34:o,35:i,36:c,39:h,40:u,41:l,42:d,43:p,44:S,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N,77:O,78:P,79:M,80:A,81:_,82:E},{1:[2,2]},t(x,[2,3]),t(x,[2,5]),t(x,[2,6]),t(x,[2,7]),{11:46,67:T},t(G,I,{18:49,16:[1,48],75:L}),t(C,I,{18:51,19:w,46:R,47:D,48:V,49:F,50:U,66:$,75:L}),t(G,[2,23]),t(G,[2,24]),t(G,[2,25]),t(G,[2,26]),t(G,[2,27]),t(G,[2,28]),{11:59,67:T},t(B,[2,50],{16:[1,75],51:[1,60],52:[1,61],53:[1,62],54:[1,63],55:[1,64],56:[1,65],57:[1,66],58:[1,67],59:[1,68],60:[1,69],61:[1,70],62:[1,71],63:[1,72],64:[1,73],65:[1,74]}),{17:76,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{7:84,8:83,9:82,10:r,14:11,15:9,17:85,20:17,21:n,24:H,25:a,26:z,27:79,28:80,29:s,30:13,31:14,32:15,33:16,34:o,35:i,36:c,39:h,40:u,41:l,42:d,43:p,44:S,45:18,47:k,67:f,68:g,69:m,70:y,71:v,72:81,73:b,74:N,77:O,78:P,79:M,80:A,81:_,82:E},{21:[1,86]},{21:[1,87]},{9:88,14:11,17:10,21:n,25:a,29:s,30:13,31:14,32:15,33:16,34:o,35:i,36:c,39:h,40:u,41:l,42:d,43:p,44:S,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{21:[1,89]},t(G,I,{18:90,75:L}),t(G,I,{18:91,75:L}),t(q,I,{45:18,17:92,18:93,21:n,25:Z,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N,75:L}),t(q,I,{45:18,18:94,17:95,21:n,25:Z,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N,75:L}),{17:96,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},t(J,[2,94]),t(J,[2,95]),t(J,[2,96]),t(J,[2,97]),t(J,[2,98]),t(J,[2,99]),t([5,10,16,19,22,24,25,26,29,34,35,36,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,73,74,75,77,78,79,80,81,82],[2,75],{21:[1,97]}),t(W,[2,76]),t(W,[2,77]),t(W,[2,78]),{21:n,25:Z,45:98,67:f,68:g,69:m,70:y,71:v,73:b,74:N},t(X,H,{45:18,17:99,72:100,21:n,25:Z,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N}),t(W,[2,84]),t(W,[2,85]),{1:[2,1]},t(x,[2,4]),{12:101,21:[1,102]},t(j,[2,88]),{17:103,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},t(K,[2,10]),t(K,[2,86]),t(G,[2,22]),{17:104,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:105,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:106,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:107,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:108,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:109,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:110,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},t(j,[2,17]),{17:111,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:112,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:113,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:114,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:115,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},t(B,[2,61]),t(B,[2,62]),{17:116,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:117,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:118,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:119,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:120,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:121,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:122,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:123,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:124,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},t(Y,[2,74],{19:w,50:U}),t([24,26],H,{45:18,72:81,17:125,21:n,25:Z,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N}),t(Q,[2,18]),{7:84,8:83,9:127,10:r,14:11,15:9,17:10,20:17,21:n,25:a,26:[1,126],28:128,29:s,30:13,31:14,32:15,33:16,34:o,35:i,36:c,39:h,40:u,41:l,42:d,43:p,44:S,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N,77:O,78:P,79:M,80:A,81:_,82:E},{7:132,8:131,9:82,10:r,14:11,15:9,17:10,20:17,21:n,25:a,26:[1,129],27:130,29:s,30:13,31:14,32:15,33:16,34:o,35:i,36:c,39:h,40:u,41:l,42:d,43:p,44:S,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N,77:O,78:P,79:M,80:A,81:_,82:E},{24:ee,26:[1,133]},t(te,[2,47]),t(te,[2,43]),t(te,[2,44]),t([10,21,25,29,34,35,36,39,40,41,42,43,44,67,68,69,70,71,73,74,77,78,79,80,81,82],I,{18:51,19:w,24:re,26:re,46:R,47:D,48:V,49:F,50:U,66:$,75:L}),{17:135,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:136,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{39:[1,137]},{8:138,15:9,20:17,77:O,78:P,79:M,80:A,81:_,82:E},t(G,[2,39]),t(G,[2,40]),t(C,I,{18:139,19:w,46:R,47:D,48:V,49:F,50:U,66:$,75:L}),t(G,[2,42]),t(G,[2,29]),t(C,I,{18:140,19:w,46:R,47:D,48:V,49:F,50:U,66:$,75:L}),t(C,I,{18:141,19:w,46:R,47:D,48:V,49:F,50:U,66:$,75:L}),t(X,H,{45:18,17:125,72:142,21:n,25:Z,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N}),t(W,[2,79]),{19:w,22:[1,143],24:re,46:R,47:D,48:V,49:F,50:U,66:$},{22:[1,144],24:ee},{13:145,19:[1,146],25:[2,12]},{15:149,20:17,22:[1,147],23:148,77:O,78:P,79:M,80:A,81:_,82:E},t(C,I,{18:150,19:w,46:R,47:D,48:V,49:F,50:U,66:$,75:L}),t(ne,[2,51],{19:w,48:V,49:F,50:U}),t(ne,[2,52],{19:w,48:V,49:F,50:U}),t(Y,[2,53],{19:w,50:U}),t(Y,[2,54],{19:w,50:U}),t(ae,[2,55],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t([5,10,21,22,24,25,26,29,34,35,36,39,40,41,42,43,44,66,67,68,69,70,71,73,74,75,77,78,79,80,81,82],[2,72],{19:w,46:R,47:D,48:V,49:F,50:U}),t(ae,[2,73],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,56],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,57],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,58],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,59],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,60],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,63],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,64],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,65],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,66],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,67],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,68],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,69],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,70],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(ae,[2,71],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(se,re,{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),t(Q,[2,19]),t(te,[2,48]),t([21,25,26,29,34,35,36,39,40,41,42,43,44,47,67,68,69,70,71,73,74],[2,49],{15:9,20:17,8:131,7:132,10:r,77:O,78:P,79:M,80:A,81:_,82:E}),t(Q,[2,20]),{7:84,8:83,9:127,10:r,14:11,15:9,17:10,20:17,21:n,25:a,26:[1,151],28:128,29:s,30:13,31:14,32:15,33:16,34:o,35:i,36:c,39:h,40:u,41:l,42:d,43:p,44:S,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N,77:O,78:P,79:M,80:A,81:_,82:E},t(te,[2,45]),t(te,[2,46]),t(W,[2,82]),{17:152,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{19:w,22:[1,153],46:R,47:D,48:V,49:F,50:U,66:$},{19:w,22:[1,154],46:R,47:D,48:V,49:F,50:U,66:$},{21:[1,155]},t([21,25,47,67,68,69,70,71,73,74],I,{18:156,75:L}),t(G,[2,41]),t(G,[2,30]),t(G,[2,31]),{22:[1,157],24:ee},t(W,[2,80]),t(W,[2,83]),{14:158,25:oe},{20:160,77:O,78:P,79:M,80:A,81:_,82:E},t(ie,[2,13]),{22:[1,161],24:[1,162]},t(X,[2,15]),t(K,[2,9]),t(Q,[2,21]),t(se,[2,92],{19:w,46:R,47:D,48:V,49:F,50:U,66:$}),{14:163,25:oe},{9:164,14:11,17:10,21:n,25:a,29:s,30:13,31:14,32:15,33:16,34:o,35:i,36:c,39:h,40:u,41:l,42:d,43:p,44:S,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:165,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{17:166,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},t(W,[2,81]),t(G,[2,8]),{7:84,8:83,9:82,10:r,14:11,15:9,17:10,20:17,21:n,25:a,26:z,27:79,28:80,29:s,30:13,31:14,32:15,33:16,34:o,35:i,36:c,39:h,40:u,41:l,42:d,43:p,44:S,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N,77:O,78:P,79:M,80:A,81:_,82:E},{25:[2,11]},t(ie,[2,14]),{15:167,20:17,77:O,78:P,79:M,80:A,81:_,82:E},t(G,ce,{37:168,38:he}),t(G,[2,36]),{19:w,22:[1,170],46:R,47:D,48:V,49:F,50:U,66:$},t([21,25,67,68,69,70,71,73,74],I,{18:171,19:w,46:R,47:D,48:V,49:F,50:U,66:$,75:L}),t(X,[2,16]),t(G,[2,32]),{14:173,25:oe,36:[1,172]},t(G,I,{18:174,75:L}),{17:175,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{21:[1,176]},t(G,[2,34]),t(G,[2,37]),{19:w,22:[1,177],46:R,47:D,48:V,49:F,50:U,66:$},{17:178,21:n,25:Z,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{9:179,14:11,17:10,21:n,25:a,29:s,30:13,31:14,32:15,33:16,34:o,35:i,36:c,39:h,40:u,41:l,42:d,43:p,44:S,45:18,47:k,67:f,68:g,69:m,70:y,71:v,73:b,74:N},{19:w,22:[1,180],46:R,47:D,48:V,49:F,50:U,66:$},t(G,[2,38]),{14:181,25:oe},t(G,ce,{37:182,38:he}),t(G,[2,33])],defaultActions:{3:[2,2],44:[2,1],160:[2,11]},parseError:function(e,t){if(!t.recoverable)throw new Error(e);this.trace(e)},parse:function(e){function t(){var e;return e=S.lex()||d,"number"!=typeof e&&(e=r.symbols_[e]||e),e}var r=this,n=[0],a=[null],s=[],o=this.table,i="",c=0,h=0,u=0,l=2,d=1,p=s.slice.call(arguments,1),S=Object.create(this.lexer),k={yy:{}};for(var f in this.yy)Object.prototype.hasOwnProperty.call(this.yy,f)&&(k.yy[f]=this.yy[f]);S.setInput(e,k.yy),k.yy.lexer=S,k.yy.parser=this,"undefined"==typeof S.yylloc&&(S.yylloc={});var g=S.yylloc;s.push(g);var m=S.options&&S.options.ranges;"function"==typeof k.yy.parseError?this.parseError=k.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var y,v,b,N,O,P,M,A,_,E={};;){if(b=n[n.length-1],this.defaultActions[b]?N=this.defaultActions[b]:((null===y||"undefined"==typeof y)&&(y=t()),N=o[b]&&o[b][y]),"undefined"==typeof N||!N.length||!N[0]){var x="";_=[];for(P in o[b])this.terminals_[P]&&P>l&&_.push("'"+this.terminals_[P]+"'");x=S.showPosition?"Parse error on line "+(c+1)+":\n"+S.showPosition()+"\nExpecting "+_.join(", ")+", got '"+(this.terminals_[y]||y)+"'":"Parse error on line "+(c+1)+": Unexpected "+(y==d?"end of input":"'"+(this.terminals_[y]||y)+"'"),this.parseError(x,{text:S.match,token:this.terminals_[y]||y,line:S.yylineno,loc:g,expected:_})}if(N[0]instanceof Array&&N.length>1)throw new Error("Parse Error: multiple actions possible at state: "+b+", token: "+y);switch(N[0]){case 1:n.push(y),a.push(S.yytext),s.push(S.yylloc),n.push(N[1]),y=null,v?(y=v,v=null):(h=S.yyleng,i=S.yytext,c=S.yylineno,g=S.yylloc,u>0&&u--);break;case 2:if(M=this.productions_[N[1]][1],E.$=a[a.length-M],E._$={first_line:s[s.length-(M||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(M||1)].first_column,last_column:s[s.length-1].last_column},m&&(E._$.range=[s[s.length-(M||1)].range[0],s[s.length-1].range[1]]),O=this.performAction.apply(E,[i,h,c,k.yy,N[1],a,s].concat(p)),"undefined"!=typeof O)return O;M&&(n=n.slice(0,-1*M*2),a=a.slice(0,-1*M),s=s.slice(0,-1*M)),n.push(this.productions_[N[1]][0]),a.push(E.$),s.push(E._$),A=o[n[n.length-2]][n[n.length-1]],n.push(A);break;case 3:return!0}}return!0}},le=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,r=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),r.length-1&&(this.yylineno-=r.length-1);var a=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:r?(r.length===n.length?this.yylloc.first_column:0)+n[n.length-r.length].length-r[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var r,n,a;if(this.options.backtrack_lexer&&(a={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(a.yylloc.range=this.yylloc.range.slice(0))),n=e[0].match(/(?:\r\n?|\n).*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],r=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),r)return r;if(this._backtrack){for(var s in a)this[s]=a[s];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,r,n;this._more||(this.yytext="",this.match="");for(var a=this._currentRules(),s=0;s<a.length;s++)if(r=this._input.match(this.rules[a[s]]),r&&(!t||r[0].length>t[0].length)){if(t=r,n=s,this.options.backtrack_lexer){if(e=this.test_match(r,a[s]),e!==!1)return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?(e=this.test_match(t,a[n]),e!==!1?e:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){var e=this.conditionStack.length-1;return e>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules;
},topState:function(e){return e=this.conditionStack.length-1-Math.abs(e||0),e>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,r,n){switch(r){case 0:break;case 1:break;case 2:break;case 3:return 79;case 4:return 43;case 5:return 34;case 6:return 35;case 7:return 42;case 8:return 40;case 9:return 38;case 10:return 70;case 11:return 41;case 12:return 10;case 13:return 36;case 14:return 81;case 15:return 78;case 16:return"NOT";case 17:return"NULL";case 18:return 80;case 19:return 82;case 20:return 44;case 21:return 69;case 22:return 77;case 23:return 39;case 24:return 73;case 25:return 74;case 26:return 25;case 27:return 26;case 28:return"OPEN_BRACKET";case 29:return"CLOSE_BRACKET";case 30:return 21;case 31:return 22;case 32:return 24;case 33:return"COLON";case 34:return 75;case 35:return 19;case 36:return 16;case 37:return 51;case 38:return 56;case 39:return 46;case 40:return 52;case 41:return 57;case 42:return 47;case 43:return 53;case 44:return 48;case 45:return 54;case 46:return 49;case 47:return 55;case 48:return 50;case 49:return 58;case 50:return 59;case 51:return 60;case 52:return 61;case 53:return 62;case 54:return 63;case 55:return 64;case 56:return 65;case 57:return 71;case 58:return 66;case 59:return 5;case 60:return 68;case 61:return 67}},rules:[/^(?:\s+)/,/^(?:\/\/.*)/,/^(?:#.*)/,/^(?:bool\b)/,/^(?:break\b)/,/^(?:clear\b)/,/^(?:draw\b)/,/^(?:continue\b)/,/^(?:do\b)/,/^(?:else\b)/,/^(?:false\b)/,/^(?:for\b)/,/^(?:function\b)/,/^(?:if\b)/,/^(?:line\b)/,/^(?:num\b)/,/^(?:not\b)/,/^(?:null\b)/,/^(?:point\b)/,/^(?:polygon\b)/,/^(?:return\b)/,/^(?:true\b)/,/^(?:void\b)/,/^(?:while\b)/,/^(?:width\b)/,/^(?:height\b)/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:\()/,/^(?:\))/,/^(?:,)/,/^(?::)/,/^(?:;)/,/^(?:->)/,/^(?:=)/,/^(?:\+=)/,/^(?:\+\+)/,/^(?:\+)/,/^(?:-=)/,/^(?:--)/,/^(?:-)/,/^(?:\*=)/,/^(?:\*)/,/^(?:\/=)/,/^(?:\/)/,/^(?:%=)/,/^(?:%)/,/^(?:&&)/,/^(?:\|\|)/,/^(?:\?=)/,/^(?:\?<)/,/^(?:\?>)/,/^(?:!=)/,/^(?:!>)/,/^(?:!<)/,/^(?:!)/,/^(?:~)/,/^(?:$)/,/^(?:[0-9]+(\.[0-9]*)?)/,/^(?:[a-zA-Z_]+[a-zA-Z0-9_]*)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61],inclusive:!0}}};return e}();return ue.lexer=le,e.prototype=ue,ue.Parser=e,new e}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=sketchParse,exports.Parser=sketchParse.Parser,exports.parse=function(){return sketchParse.parse.apply(sketchParse,arguments)},exports.main=function(e){e[1]||(console.log("Usage: "+e[0]+" FILE"),process.exit(1));var t=require("fs").readFileSync(require("path").normalize(e[1]),"utf8");return exports.parser.parse(t)},"undefined"!=typeof module&&require.main===module&&exports.main(process.argv.slice(1)));var MVM=MVM||{};MVM.DataModel=function(){this.root=new MVM.StackFrame(null),this.stack=[this.root]},MVM.DataModel.prototype={current:function(){try{return this.stack[this.stack.length-1]}catch(e){return void 0}},relative:function(e){for(var t=this.current();e>0&&t&&t.parent;)t=t.parent,e--;if(e>0)throw"Invalid relative call - too few parents.";return t},enter:function(){var e=new MVM.StackFrame(this.current());return this.stack[this.stack.length-1]=e,this},exit:function(){if(this.current()===this.root)throw"Tried to exit from scope past root level.";return this.stack[this.stack.length-1]=this.current().parent,this},call:function(e,t,r){var n=this.current(),a=this.relative(t);this.stack.push(new MVM.StackFrame(a));var s=this.current();for(s.returnAddr=r,s.functionBase=!0;e>0;)s.setVar(e-1,n.pop()),e--;return this},funcreturn:function(e){for(var t=this.stack.pop();!t.functionBase;)t=t.parent;return null!==e&&this.current().push(e),t.returnAddr}},MVM.StackFrame=function(e){this.parent=e,this.variables=[],this.stack=[],this.returnAddr=void 0,this.functionBase=!1},MVM.StackFrame.prototype={push:function(e){return this.stack.push(e),this},pop:function(){return this.stack.pop()},peek:function(){try{return this.stack[this.stack.length-1]}catch(e){return void 0}},setVar:function(e,t){return this.variables[e]=t,this},getVar:function(e){return this.variables[e]}};var MVM=MVM||{};MVM.VM=function(e,t,r,n){function a(e,t,r){var n=e[0],a=e[1],s=t[0],o=t[1],i=Math.sin(r*(Math.PI/180)),c=Math.cos(r*(Math.PI/180));s-=n,o-=a;var h=s*c-o*i,u=s*i+o*c;h+=n,u+=a;var l=[h,u];return l}var s,o=[],e=e,t=t,i=0,c=0;window.MVM.dataStore=[];var h=new MVM.DataModel,u=0,l=0;this.dead=!1,this.interpret=function(){if(this.dead!==!0){var d=window.MVM.dataStore;n&&console.log(r),s=r.length;for(var p=MVM.opCodes;s>c&&0==l;){i++;var S=r[c];switch(c++,S){case p.STOREG:var k=r[c++],f=h.current().pop();h.root.setVar(k,f),n&&console.log("STOREG: "+f+" in index "+k);break;case p.LOADG:var k=r[c++],f=h.root.getVar(k);h.current().push(f),n&&console.log("LOADG: "+f+" from index "+k);break;case p.STOREL:var k=r[c++],f=h.current().pop();h.current().setVar(k,f),n&&console.log("STOREL: "+f+" in index "+k);break;case p.LOADL:var k=r[c++],f=h.current().getVar(k);h.current().push(f),n&&console.log("LOADL: "+f+" from index "+k);break;case p.LOADC:var g=r[c++];h.current().push(g),n&&console.log("LOADC: "+g);break;case p.IADD:var m=Math.floor(h.current().pop()),y=Math.floor(h.current().pop()),v=y+m;h.current().push(v),n&&console.log("IADD: "+y+" + "+m+" = "+v);break;case p.ISUB:var m=Math.floor(h.current().pop()),y=Math.floor(h.current().pop()),v=y-m;h.current().push(v),n&&console.log("ISUB: "+y+" - "+m+" = "+v);break;case p.IMUL:var m=Math.floor(h.current().pop()),y=Math.floor(h.current().pop()),v=y*m;h.current().push(v),n&&console.log("IMUL: "+y+" * "+m+" = "+v);break;case p.IDIV:var m=Math.floor(h.current().pop()),y=Math.floor(h.current().pop()),v=Math.floor(y/m);h.current().push(v),n&&console.log("IDIV: "+y+" / "+m+" = "+v);break;case p.IMOD:var m=Math.floor(h.current().pop()),y=Math.floor(h.current().pop()),v=Math.floor(y%m);h.current().push(v),n&&console.log("IMOD: "+y+" % "+m+" = "+v);break;case p.FADD:var m=h.current().pop(),y=h.current().pop(),v=y+m;h.current().push(v),n&&console.log("FADD: "+y+" + "+m+" = "+v);break;case p.FSUB:var m=h.current().pop(),y=h.current().pop(),v=y-m;h.current().push(v),n&&console.log("FSUB: "+y+" - "+m+" = "+v);break;case p.FMUL:var m=h.current().pop(),y=h.current().pop(),v=y*m;h.current().push(v),n&&console.log("FMUL: "+y+" * "+m+" = "+v);break;case p.FDIV:var m=h.current().pop(),y=h.current().pop(),v=y/m;h.current().push(v),n&&console.log("FDIV: "+y+" / "+m+" = "+v);break;case p.FMOD:var m=h.current().pop(),y=h.current().pop(),v=y%m;h.current().push(v),n&&console.log("FMOD: "+y+" % "+m+" = "+v);break;case p.CMPEQ:var m=h.current().pop(),y=h.current().pop(),v=y==m;h.current().push(v),n&&console.log("CMPEQ: "+y+" == "+m+" = "+v);break;case p.CMPLT:var m=h.current().pop(),y=h.current().pop(),v=m>y;h.current().push(v),n&&console.log("CMPLT: "+y+" < "+m+" = "+v);break;case p.CMPGT:var m=h.current().pop(),y=h.current().pop(),v=y>m;h.current().push(v),n&&console.log("CMPGT: "+y+" > "+m+" = "+v);break;case p.JUMP:var b=r[c];c=b,n&&console.log("JUMP: "+b);break;case p.JUMPT:var b=r[c++],m=h.current().pop();m&&(c=b),n&&console.log("JUMPT: to "+b+", cond is "+m);break;case p.JUMPF:var b=r[c++],m=h.current().pop();m||(c=b),n&&console.log("JUMPF: to "+b+", cond is "+m);break;case p.CALL:var N=r[c++],O=r[c++],P=r[c++],M=c;h.call(P,N,M),c=O,n&&console.log("CALL: "+O+"  with "+P+" arguments, return to "+M);break;case p.RETURNVAL:var A=h.current().pop();c=h.funcreturn(A),n&&console.log("RETURNVAL: "+A+" returned, exiting function. New code pointer is "+c);break;case p.RETURN:c=h.funcreturn(null),n&&console.log("RETURN: void return, exiting function.");break;case p.LNDRAW:var _=h.current().pop(),E=_[0],x=_[1],T=_[2],G=_[3],I=_[4],L=_[5],C=_[6],w=_[7],R=new Float32Array([I,L,0,C,w,0]),D=new Float32Array([E,x,T,G]),V=t.getProgram("square","square"),F=e.canvas.width,U=e.canvas.height;V.setDrawMode(Palette.Program.LINES),V.draw(R,{width:[F],height:[U]},{color:D}),n&&console.log("LNDRAW: "+_);break;case p.PGDRAW:var $=h.current().pop(),E=$[0],x=$[1],T=$[2],G=$[3],D=new Float32Array([E,x,T,G]),B=$.slice(4),V=t.getProgram("square","square");V.setDrawMode(Palette.Program.POLYGON);var F=e.canvas.width,U=e.canvas.height;V.draw(B,{width:[F],height:[U]},{color:D}),n&&console.log("PGDRAW: "+$);break;case p.RENDER:l=1,n&&console.log("RENDER");break;case p.CLEAR:var Z=h.current().pop();Z&&(Z.length<4&&(Z[3]=1),e.clearColor(Z[0],Z[1],Z[2],Z[3])),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),n&&console.log("CLEAR");break;case p.EXIT:c=s,n&&console.log("EXIT");break;case p.LOADIDX:var H=r[c];c++;var z=r[c];c++;var q=o[H],A=q[z];d[u]=A,u++,n&&console.log("LOADIDX: constant pool index "+H+" array index: "+z);break;case p.SETIDX:var H=r[c];c++;var z=r[c];c++;var q=o[H];u--;var A=d[u];q[z]=A,n&&console.log("SETIDX: constant pool index "+H+" array index: "+z);break;case p.LNTOPG:u--;var J=d[u];u--;for(var W=d[u],X=o[J],j=X.slice(0),m=2,K=360/W,Y=4,Q=5,ee=6,te=7,re=8,ne=9;W>m;){var ae=[j[Y],j[Q]],se=[j[ee],j[te]],oe=a(ae,se,K);offSetx=j[Y]-j[ee],offSety=j[Q]-j[te],oe[0]-=offSetx,oe[1]-=offSety,j[re]=oe[0],j[ne]=oe[1],Y+=2,Q+=2,ee+=2,te+=2,re+=2,ne+=2,m++}var ie=r[c];c++,o[ie]=j,n&&console.log("LNTOPG "+j);break;case p.PTADD:var ce=h.current().pop(),he=h.current().pop(),X=[1,1,1,1,he[0],he[1],ce[0],ce[1]];h.current().push(X),n&&console.log("PTADD "+X);break;case p.LNMUL:u--;var ue=d[u];u--;var J=d[u],X=o[J];I=X[4],L=X[5],C=X[6],w=X[7];var le=C-I,de=w-L,pe=le*ue-le,Se=de*ue-de,ke=r[c];c++;var fe=X.slice(0);fe[6]+=pe,fe[7]+=Se,fe[0]=0,fe[1]=1,fe[2]=0,fe[3]=1,o[ke]=fe,n&&console.log("LNMUL "+fe);break;case p.STORER:var ge=r[c++],k=r[c++],f=h.current().pop();h.relative(ge).setVar(k,f),n&&console.log("STORER: placed "+f+" in index "+k+" of relative frame "+ge+".");break;case p.LOADR:var ge=r[c++],k=r[c++],f=h.relative(ge).getVar(k);h.current().push(f),n&&console.log("LOADR: retrieved "+f+" from index "+k+" of relative frame "+ge+".");break;case p.POPSC:n&&(console.log("POPSC: exiting scope:"),console.log(h.current())),h.exit(),n&&console.log("POPSC: exited current block level.");break;case p.PUSHSC:h.enter(),n&&console.log("PUSHSC: entered new block level.");break;case p.BAND:var m=h.current().pop(),y=h.current().pop(),v=y&&m;h.current().push(v),n&&console.log("BAND: "+y+" && "+m+" = "+v);break;case p.BOR:var m=h.current().pop(),y=h.current().pop(),v=y||m;h.current().push(v),n&&console.log("BOR: "+y+" || "+m+" = "+v);break;case p.BNEG:var m=h.current().pop(),v=!m;h.current().push(v),n&&console.log("BNEG: !"+m+" = "+v);break;case p.AGGR:for(var me=r[c++],ye=[];me-->0;){var m=h.current().pop();ye.unshift(m)}h.current().push(ye),n&&console.log("AGGR: output "+ye);break;case p.WIDTH:h.current().push(e.canvas.width),n&&console.log("WIDTH: "+e.canvas.width);break;case p.HEIGHT:h.current().push(e.canvas.height),n&&console.log("WIDTH: "+e.canvas.height);break;case p.AUGPT:var ye,m=h.current().pop(),y=h.current().pop();ye=m.length>y.length?m.concat(y):y.concat(m),h.current().push(ye),n&&console.log("AUGPT: "+m+" + "+y+" = "+ye);break;case p.SETCOLOUR:var Z=h.current().pop(),ve=h.current().pop();3===Z.size&&(Z[3]=1);for(var m=0;m<Z.length;m++)ve[m]=Z[m];h.current().push(ve),n&&console.log("SETCOLOUR: "+ve+" ~ "+Z+" = "+ye);break;case p.TRANSLATEPT:for(var be=h.current().pop(),se=h.current().pop(),ye=se.slice(),m=0;m<be.length;m++)ye[m]+=be[m];h.current().push(ye),n&&console.log("TRASLATEPT: ["+se+"] -> ["+be+"] = ["+ye+"]");break;case p.TRANSLATESTRUCT:for(var be=h.current().pop(),Ne=h.current().pop(),ye=Ne.slice(),m=4;m<Ne.length;m++)ye[m]+=be[m%2];h.current().push(ye),n&&console.log("TRASLATESTRUCT: ["+Ne+"] -> ["+be+"] = ["+ye+"]")}}return l&&render(),h}},render=function(){l=0,window.requestAnimationFrame(window.mvm.interpret)},this.call=function(e,t){for(var n=r.length,a=0;a<t.length;a++)h.current().push(t[a]);return h.call(t.length,0,n),c=e,this.interpret()},this.kill=function(){this.dead=!0}},MVM.opCodes={STOREG:0,LOADG:1,STOREL:2,LOADL:3,LOADC:4,IADD:5,ISUB:6,IMUL:7,IDIV:8,IMOD:9,FADD:10,FSUB:11,FMUL:12,FDIV:13,FMOD:14,LOADIDX:15,SETIDX:16,CMPEQ:17,CMPLT:18,CMPGT:19,JUMP:20,JUMPT:21,JUMPF:22,CALL:23,RETURN:24,LNDRAW:25,PGDRAW:26,RENDER:27,CLEAR:28,PTADD:29,LNTOPG:30,LNMUL:31,EXIT:32,STORER:33,LOADR:34,POPSC:35,PUSHSC:36,RETURNVAL:37,BAND:38,BOR:39,BNEG:40,AGGR:41,WIDTH:42,HEIGHT:43,AUGPT:44,SETCOLOUR:45,TRANSLATEPT:46,TRANSLATESTRUCT:47};var Sketch=Sketch||{};Sketch.SketchGen=function(){var e=[],t=0,r=[],n=0,a=[],s=!1,o=Sketch.bindInstructions(this);this.emit=function(r){return e.push(r),t++},this.patch=function(t,r){e[t]=r},this.pc=function(){return t},this.interpretNode=function(e,t){return Array.isArray(e)?void e.forEach(this.interpretNode.bind(this)):""===e?void 0:(s&&(console.log("{\n"+Sketch.SketchGenNodes._rev[e.type]+","),console.log(e.arguments),console.log("}")),o[e.type](e.arguments,t))},this.scopePush=function(e){r.push(new Sketch.SketchGen.ScopeStackFrame),n++,e||this.emit(MVM.opCodes.PUSHSC)},this.scopePop=function(e){r.pop(),n--,e||this.emit(MVM.opCodes.POPSC)},this.scopeRegister=function(e,a,s){var o=r[n];if(o.labelTable[e])throw"Illegal attempt to redefine variable "+e+".";var i="function"===a?t:o.nextData++;o.labelTable[e]=new Sketch.SketchGen.Label(i,a,s)},this.scopeLookup=function(e){var t=0,a=null;for(null;n-t>=0;t++){var s=r[n-t],o=s.labelTable[e];if(o){a={entry:o,stack:t};break}}if(null===a)throw"BAD LOOKUP.";return a},this.interpret=function(t){this.cleanState(),this.interpretNode({type:Sketch.SketchGenNodes.program,arguments:t});var r=null,n=null;try{var a=this.scopeLookup("init");"function"===a.entry.type&&(r=a.entry.address)}catch(s){}try{var o=this.scopeLookup("render");"function"===o.entry.type&&(n=o.entry.address)}catch(s){}return{code:e,initAddr:r,renderAddr:n}},this.cleanState=function(){e=[],t=0,r=[],r.push(new Sketch.SketchGen.ScopeStackFrame),n=0,a=[]},this.beginFunction=function(e){a.push(e)},this.endFunction=function(){a.pop()},this.currentFunctionType=function(){if(0===a.length)throw"Not currently defining a function, can't find its type!";return a[a.length-1]}},Sketch.SketchGen.ScopeStackFrame=function(){this.labelTable={},this.nextData=0},Sketch.SketchGen.Label=function(e,t,r){this.address=e,this.type=t,r&&(this.extra=r)},Sketch.sketchGenDefaultReturns={"void":null,num:0,bool:!1,point:[0,0],line:[0,0,0,0],polygon:[0,0,0,0,0,0]},Sketch.EnumBase=function(){var e=0;this._rev=[],this.propAdd=function(t){this._rev[e]=t,this[t]=e++}},Sketch.SketchGenNodes=new Sketch.EnumBase,Sketch.SketchGenNodes.propAdd("program"),Sketch.SketchGenNodes.propAdd("block"),Sketch.SketchGenNodes.propAdd("function"),Sketch.SketchGenNodes.propAdd("func_call"),Sketch.SketchGenNodes.propAdd("return"),Sketch.SketchGenNodes.propAdd("if"),Sketch.SketchGenNodes.propAdd("else"),Sketch.SketchGenNodes.propAdd("else_if"),Sketch.SketchGenNodes.propAdd("variable_decl"),Sketch.SketchGenNodes.propAdd("variable_decl_assign"),Sketch.SketchGenNodes.propAdd("decl"),Sketch.SketchGenNodes.propAdd("assign"),Sketch.SketchGenNodes.propAdd("addition"),Sketch.SketchGenNodes.propAdd("subtraction"),Sketch.SketchGenNodes.propAdd("multiplication"),Sketch.SketchGenNodes.propAdd("division"),Sketch.SketchGenNodes.propAdd("modulo"),Sketch.SketchGenNodes.propAdd("unary_minus"),Sketch.SketchGenNodes.propAdd("increment"),Sketch.SketchGenNodes.propAdd("decrement"),Sketch.SketchGenNodes.propAdd("add_assign"),Sketch.SketchGenNodes.propAdd("sub_assign"),Sketch.SketchGenNodes.propAdd("mul_assign"),Sketch.SketchGenNodes.propAdd("div_assign"),Sketch.SketchGenNodes.propAdd("mod_assign"),Sketch.SketchGenNodes.propAdd("colour"),Sketch.SketchGenNodes.propAdd("translate"),Sketch.SketchGenNodes.propAdd("and"),Sketch.SketchGenNodes.propAdd("or"),Sketch.SketchGenNodes.propAdd("equal"),Sketch.SketchGenNodes.propAdd("not_equal"),Sketch.SketchGenNodes.propAdd("negate"),Sketch.SketchGenNodes.propAdd("less_than"),Sketch.SketchGenNodes.propAdd("greater_than"),Sketch.SketchGenNodes.propAdd("less_than_or_equal"),Sketch.SketchGenNodes.propAdd("greater_than_or_equal"),Sketch.SketchGenNodes.propAdd("num"),Sketch.SketchGenNodes.propAdd("ident"),Sketch.SketchGenNodes.propAdd("bool"),Sketch.SketchGenNodes.propAdd("point"),Sketch.SketchGenNodes.propAdd("width"),Sketch.SketchGenNodes.propAdd("height"),Sketch.SketchGenNodes.propAdd("draw"),Sketch.SketchGenNodes.propAdd("clear"),Sketch.SketchGenNodes.propAdd("clear_colour");var createNode=function(e,t){return{type:Sketch.SketchGenNodes[e],arguments:t}},boolNegateNode=function(e){return createNode("negate",e)},resolveType=function(e){return"ident"===e.type&&(e=e.data.entry),e},loadAndOperate=function(e,t,r){for(var n=[],a=0;a<t.length;a++){var s=e.interpretNode(t[a]);n.push(resolveType(s))}var o=Sketch.SketchGenOperandTable.lookup(r,n);e.emit(o.value.code);var i=o.value;return o.extra&&(i.extra=o.extra),i},primitive=function(e,t,r){return e.emit(MVM.opCodes.LOADC),e.emit(t),{type:r}},assignmentOperand=function(e,t,r){e.interpretNode(createNode("assign",[t[0],createNode(r,[t[0],t[1]])]))},increment=function(e,t,r){return e.interpretNode(t[0]),assignmentOperand(e,[t[0],createNode("num",r)],"addition"),Sketch.SketchGenOperandTable.lookup(r>0?"++":"--",[Sketch.SketchGenNodes._rev[t[0]]]).value};Sketch.SketchGenInstr=[],Sketch.addInstruction=function(e,t){Sketch.SketchGenInstr[Sketch.SketchGenNodes[e]]=t},Sketch.addInstruction("program",function(e){this.interpretNode(e),this.emit(MVM.opCodes.EXIT)}),Sketch.addInstruction("block",function(e,t){return this.scopePush(t),this.interpretNode(e),this.scopePop(t),{type:null}}),Sketch.addInstruction("function",function(e){this.beginFunction(e[2]),this.emit(MVM.opCodes.JUMP);var t=this.emit(255),r=[];e[1].forEach(function(e){r.push(e.arguments[0])}),this.scopeRegister(e[0],"function",{returnType:e[2],paramTypes:r}),this.interpretNode(createNode("block",[e[1],e[3].arguments]),!0);var n=Sketch.sketchGenDefaultReturns[e[2]];return null===n?this.emit(MVM.opCodes.RETURN):(this.interpretNode(createNode(e[2],n)),this.emit(MVM.opCodes.RETURNVAL)),this.patch(t,this.pc()),this.endFunction(),{type:"function"}}),Sketch.addInstruction("func_call",function(e){var t=this.scopeLookup(e[0]);if("function"!==t.entry.type)throw"Tried to call "+e[0]+" as though it were a function - it is a "+t.type+"!";if(void 0===e[1].length&&(e[1].length=0),t.entry.extra.paramTypes.length!==e[1].length)throw"Parameter length mismatch.";for(var r=0;r<e[1].length;r++){var n=resolveType(this.interpretNode(e[1][r])).type,a=t.entry.extra.paramTypes[r];if(n!==a)throw"Type mismatch on parameter "+r+" of call to "+e[0]+": EXPECTED "+a+", not"+n+"."}return this.emit(MVM.opCodes.CALL),this.emit(t.stack),this.emit(t.entry.address),this.emit(e[1].length),{type:t.entry.extra.returnType}}),Sketch.addInstruction("return",function(e){if(null===e)this.emit(MVM.opCodes.RETURN);else{var t=resolveType(this.interpretNode(e)).type;this.emit(MVM.opCodes.RETURNVAL);var r=this.currentFunctionType();if(t!==r)throw"ERROR: expected return type of "+r+", given "+t+"."}return{type:null}}),Sketch.addInstruction("if",function(e){var t=[],r=this;e.forEach(function(e){var n=r.interpretNode(e);t.push(n.patch)});var n=this.pc();return t.forEach(function(e){null!==e&&r.patch(e,n)}),{type:null}}),Sketch.addInstruction("else_if",function(e){var t=this.interpretNode(e[0]);if("bool"!==resolveType(t).type)throw"Expressions in an if-else block must be boolean type (true or false).";this.emit(MVM.opCodes.JUMPF);var r=this.emit(255),n=this.interpretNode(e[1]);return this.emit(MVM.opCodes.JUMP),n.patch=this.emit(255),this.patch(r,this.pc()),n}),Sketch.addInstruction("else",function(e){var t=this.interpretNode(e);return t.patch=null,t}),Sketch.addInstruction("variable_decl",function(e){this.interpretNode(e)}),Sketch.addInstruction("variable_decl_assign",function(e){this.interpretNode(e[0]),this.interpretNode(createNode("assign",[createNode("ident",e[0].arguments[1]),e[1]]))}),Sketch.addInstruction("decl",function(e){return this.scopeRegister(e[1],e[0]),e[0]}),Sketch.addInstruction("assign",function(e){var t=this.interpretNode(e[0],!0),r=this.interpretNode(e[1]);if("ident"!==t.type)throw"ERROR: non-identity type on left side of assignment operator.";if(resolveType(r).type!==resolveType(t).type)throw console.log("Ltype: "+resolveType(t).type+", Rtype: "+resolveType(r).type),"ERROR: right side of assignment does not match type of identifier.";return r.extra&&(t.data.entry.extra=r.extra),this.emit(MVM.opCodes.STORER),this.emit(t.data.stack),this.emit(t.data.entry.address),r}),Sketch.addInstruction("addition",function(e){return loadAndOperate(this,e,"+")}),Sketch.addInstruction("subtraction",function(e){return loadAndOperate(this,e,"-")}),Sketch.addInstruction("multiplication",function(e){return loadAndOperate(this,e,"*")}),Sketch.addInstruction("division",function(e){return loadAndOperate(this,e,"/")}),Sketch.addInstruction("modulo",function(e){return loadAndOperate(this,e,"%")}),Sketch.addInstruction("increment",function(e){return increment(this,e,1)}),Sketch.addInstruction("decrement",function(e){return increment(this,e,-1)}),Sketch.addInstruction("unary_minus",function(e){return this.interpretNode(createNode("multiplication",[e,createNode("num",[-1])]))}),Sketch.addInstruction("add_assign",function(e){return assignmentOperand(this,e,"addition")}),Sketch.addInstruction("sub_assign",function(e){return assignmentOperand(this,e,"subtraction")}),Sketch.addInstruction("mul_assign",function(e){return assignmentOperand(this,e,"multiplication")}),Sketch.addInstruction("div_assign",function(e){return assignmentOperand(this,e,"division")}),Sketch.addInstruction("mod_assign",function(e){return assignmentOperand(this,e,"modulo")}),Sketch.addInstruction("colour",function(e){return loadAndOperate(this,e,"~")}),Sketch.addInstruction("translate",function(e){return loadAndOperate(this,e,"->")}),Sketch.addInstruction("and",function(e){return loadAndOperate(this,e,"&&")}),Sketch.addInstruction("or",function(e){return loadAndOperate(this,e,"||")}),Sketch.addInstruction("equal",function(e){return loadAndOperate(this,e,"?=")}),Sketch.addInstruction("not_equal",function(e){return this.interpretNode(boolNegateNode(createNode("equal",e)))}),Sketch.addInstruction("negate",function(e){return loadAndOperate(this,[e],"!")}),Sketch.addInstruction("less_than",function(e){return loadAndOperate(this,e,"?<")}),Sketch.addInstruction("greater_than",function(e){return loadAndOperate(this,e,"?>")}),Sketch.addInstruction("less_than_or_equal",function(e){return this.interpretNode(boolNegateNode(createNode("greater_than",e)))}),Sketch.addInstruction("greater_than_or_equal",function(e){return this.interpretNode(boolNegateNode(createNode("less_than",e)))}),Sketch.addInstruction("num",function(e){return primitive(this,e,"num")}),Sketch.addInstruction("ident",function(e,t){var r=this.scopeLookup(e);return t||(this.emit(MVM.opCodes.LOADR),this.emit(r.stack),this.emit(r.entry.address)),{type:"ident",data:r}}),Sketch.addInstruction("bool",function(e){return primitive(this,e,"bool")}),Sketch.addInstruction("point",function(e){var t=e.length;if(!t)throw"Can't define a zero-size point!";return e.forEach(function(e){var t=this.interpretNode(e);if("num"!==t.type&&"num"!==t.data.entry.type)throw"Tried to place a non-numeric value into a point type."}.bind(this)),this.emit(MVM.opCodes.AGGR),this.emit(t),{type:"point",extra:{size:t}}}),Sketch.addInstruction("width",function(){return this.emit(MVM.opCodes.WIDTH),{type:"num"}}),Sketch.addInstruction("height",function(){return this.emit(MVM.opCodes.HEIGHT),{type:"num"}}),Sketch.addInstruction("draw",function(e){return loadAndOperate(this,[e],"draw")}),Sketch.addInstruction("clear",function(){return primitive(this,null,null),this.emit(MVM.opCodes.CLEAR),{type:null}}),Sketch.addInstruction("clear_colour",function(e){return loadAndOperate(this,[e],"clear")}),Sketch.bindInstructions=function(e){for(var t=[],r=0;r<Sketch.SketchGenInstr.length;r++)t[r]=Sketch.SketchGenInstr[r].bind(e);return t},Sketch.MultiKeyTable=function(){this.store={}},Sketch.MultiKeyTable.prototype={add:function(e,t,r,n,a){var s=new Sketch.MultiKeyTableEntry(this,e,t,r);this.store[e]||(this.store[e]={});for(var o=this.store[e],i=0;i<t.length;i++)o[t[i]]||(o[t[i]]={}),o=o[t[i]];return o.content=s,o.predicate=n,o.extraSelector=a,s},lookup:function(e,t){try{for(var r=this.store[e],n=0;n<t.length;n++)r=r[t[n].type];var a;if(r.content&&r.predicate){var s=r.predicate(t);if(!s.answer)throw s.reason;a=r.content}else{if(!r.content)throw"No associated entry...";a=r.content}return r.extraSelector&&(a.extra=r.extraSelector(t)),a}catch(o){var i="";throw t.forEach(function(e,t,r){i+=e.type,t!==r.length-1&&(i+=", ")}),"Operand and key combination not found for: "+e+" and "+i+": \n"+o}}},Sketch.MultiKeyTableEntry=function(e,t,r,n){this.parent=e,this.operand=t,this.keys=r,this.value=n},Sketch.MultiKeyTableEntry.prototype={reflexive:function(){this.parent.add(this.operand,this.keys.reverse(),this.value)}},Sketch.OpCheckValue=function(e,t){this.type=e,this.code=t},Sketch.SketchGenOperandTable=new Sketch.MultiKeyTable,Sketch.SketchGenOperandTable.add("+",["num","num"],new Sketch.OpCheckValue("num",MVM.opCodes.FADD));var pointPointChecker=function(e){var t;return t=e[0].extra.size>2?{answer:!1,reason:"Shapes over 2D are not yet supported."}:{answer:e[0].extra.size===e[1].extra.size,reason:"Mismatch between point sizes at addition: "+e[0].extra.size+" !== "+e[1].extra.size}},extraOfSecond=function(e){return e[1].extra};Sketch.SketchGenOperandTable.add("+",["point","point"],new Sketch.OpCheckValue("line",MVM.opCodes.PTADD),pointPointChecker,extraOfSecond),Sketch.SketchGenOperandTable.add("+",["point","line"],new Sketch.OpCheckValue("polygon",MVM.opCodes.AUGPT)).reflexive(),Sketch.SketchGenOperandTable.add("+",["point","polygon"],new Sketch.OpCheckValue("polygon",MVM.opCodes.AUGPT)).reflexive(),Sketch.SketchGenOperandTable.add("-",["num","num"],new Sketch.OpCheckValue("num",MVM.opCodes.FSUB)),Sketch.SketchGenOperandTable.add("*",["num","num"],new Sketch.OpCheckValue("num",MVM.opCodes.FMUL)),Sketch.SketchGenOperandTable.add("/",["num","num"],new Sketch.OpCheckValue("num",MVM.opCodes.FDIV)),Sketch.SketchGenOperandTable.add("%",["num","num"],new Sketch.OpCheckValue("num",MVM.opCodes.FMOD)),Sketch.SketchGenOperandTable.add("++",["ident"],new Sketch.OpCheckValue("num",null)),Sketch.SketchGenOperandTable.add("--",["ident"],new Sketch.OpCheckValue("num",null)),Sketch.SketchGenOperandTable.add("&&",["bool","bool"],new Sketch.OpCheckValue("bool",MVM.opCodes.BAND)),Sketch.SketchGenOperandTable.add("||",["bool","bool"],new Sketch.OpCheckValue("bool",MVM.opCodes.BOR)),Sketch.SketchGenOperandTable.add("?=",["bool","bool"],new Sketch.OpCheckValue("bool",MVM.opCodes.CMPEQ)),Sketch.SketchGenOperandTable.add("?=",["num","num"],new Sketch.OpCheckValue("bool",MVM.opCodes.CMPEQ)),Sketch.SketchGenOperandTable.add("?=",["point","point"],new Sketch.OpCheckValue("bool",MVM.opCodes.CMPEQ)),Sketch.SketchGenOperandTable.add("?=",["line","line"],new Sketch.OpCheckValue("bool",MVM.opCodes.CMPEQ)),Sketch.SketchGenOperandTable.add("?=",["polygon","polygon"],new Sketch.OpCheckValue("bool",MVM.opCodes.CMPEQ)),Sketch.SketchGenOperandTable.add("?<",["num","num"],new Sketch.OpCheckValue("bool",MVM.opCodes.CMPLT)),Sketch.SketchGenOperandTable.add("?>",["num","num"],new Sketch.OpCheckValue("bool",MVM.opCodes.CMPGT)),Sketch.SketchGenOperandTable.add("!",["bool"],new Sketch.OpCheckValue("bool",MVM.opCodes.BNEG)),Sketch.SketchGenOperandTable.add("draw",["line"],new Sketch.OpCheckValue(null,MVM.opCodes.LNDRAW)),Sketch.SketchGenOperandTable.add("draw",["polygon"],new Sketch.OpCheckValue(null,MVM.opCodes.PGDRAW));var colourSizeCheck=function(e){var t=e[e.length-1];return{answer:void 0===t.extra||3===t.extra.size||4===t.extra.size,reason:"Size of a colour must be 3 or 4 numbers."}};Sketch.SketchGenOperandTable.add("~",["line","point"],new Sketch.OpCheckValue("line",MVM.opCodes.SETCOLOUR),colourSizeCheck),Sketch.SketchGenOperandTable.add("~",["polygon","point"],new Sketch.OpCheckValue("polygon",MVM.opCodes.SETCOLOUR),colourSizeCheck);var pointIs2d=function(e){return{answer:void 0===e[1].extra||2===e[1].extra.size,reason:"Shapes over 2D are not yet supported."}};Sketch.SketchGenOperandTable.add("->",["point","point"],new Sketch.OpCheckValue("point",MVM.opCodes.TRANSLATEPT),pointPointChecker,extraOfSecond),Sketch.SketchGenOperandTable.add("->",["line","point"],new Sketch.OpCheckValue("line",MVM.opCodes.TRANSLATESTRUCT),pointIs2d),Sketch.SketchGenOperandTable.add("->",["polygon","point"],new Sketch.OpCheckValue("polygon",MVM.opCodes.TRANSLATESTRUCT),pointIs2d),Sketch.SketchGenOperandTable.add("clear",["point"],new Sketch.OpCheckValue(null,MVM.opCodes.CLEAR),colourSizeCheck);var Palette=Palette||{};Palette.Manager=function(e){this.context=e,this.vertShaders={},this.fragShaders={},this.programs={},this.shaderFactory=new Palette.ShaderFactory(this)},Palette.Manager.prototype={addShader:function(e){this.shaderFactory.addShader(e)},draw:function(e,t,r,n,a){this.getProgram(e,t).draw(r,n,a)},getProgram:function(e,t){var r,n,a,s=this.getShaderName(e),o=this.getShaderName(t);return this.programs[s]=this.programs[s]||{},this.programs[s][o]=this.programs[s][o]||{},this.programs[s][o]instanceof Palette.Program||(r=e instanceof Palette.Shader?e:this.getShader(Palette.Shader.VS,s),n=t instanceof Palette.Shader?t:this.getShader(Palette.Shader.FS,o),this.programs[s][o]=new Palette.Program(this.context,r,n)),a=this.programs[s][o]},getShader:function(e,t){return e===Palette.Shader.VS?this.vertShaders[t]:this.fragShaders[t]},getShaderName:function(e){var t;return t=e instanceof Palette.Shader?e.name:e}},Palette.Manager.prototype.constructor=Palette.Manager,Palette.Program=function(e,t,r){this.context=e,this.vs=t,this.fs=r,this.program=null,this.compiled=!1,this.attrs={vs:{access:{},store:{},send:{}},fs:{access:{},store:{},send:{}}},this.drawMode=Palette.Program.TRIANGLES,this.linkProgram(),this.prepareAttrStores()},Palette.Program.prototype={draw:function(e,t,r){this.context.useProgram(this.program),t||(t={});var n=this.drawMode;if(null!==e)switch(this.drawMode){case Palette.Program.POLYGON:for(var a=earcut(e,null,2),s=this.attrs.vs.access.vertexBuffer.itemSize,o=new Float32Array(a.length*s),i=2,c=0;c<a.length;c++){var h=a[c];switch(i){case 3:o[s*c+2]=e[h*i+2];case 2:o[s*c+1]=e[h*i+1];case 1:o[s*c]=e[h*i]}}t.vertexBuffer=o,n=Palette.Program.TRIANGLES;break;default:t.vertexBuffer=e}this.generateSend(this.attrs.vs,t),this.generateSend(this.attrs.fs,r),this.passAttrstoProg(),this.context.drawArrays(n,0,this.attrs.vs.send.vertexBuffer.length/this.attrs.vs.access.vertexBuffer.itemSize)},restoreDefaultConfig:function(e){for(var t,r,n=0;2>n;n++){if(n){if(!e&Palette.Program.FS_MODE)continue;r=this.fs,t=this.attrs.fs}else{if(!e&Palette.Program.VS_MODE)continue;r=this.vs,t=this.attrs.vs}for(var a=r.attrs.length-1;a>=0;a--){var s=r.attrs[a],o=s[0];"buffer"==s[1]||"vertexAttrib"==s[1]?t.store[o]=null:"vertexAttrib"!=s[1]&&(t.store[o]=s[2])}}},setConfig:function(e,t){for(var r,n,a=0;2>a;a++){if(a){if(!e&Palette.Program.FS_MODE)continue;n=this.fs,r=this.attrs.fs}else{if(!e&Palette.Program.VS_MODE)continue;n=this.vs,r=this.attrs.vs}for(var s in r.access){var o=r.store[s];void 0!==t[s]&&(o=t[s])}}},linkProgram:function(){return this.compiled?!1:(this.compiled=!0,this.program=this.context.createProgram(),this.context.attachShader(this.program,this.vs.shader),this.context.attachShader(this.program,this.fs.shader),this.context.linkProgram(this.program),!0)},prepareAttrStores:function(){this.context.useProgram(this.program);for(var e,t,r=0;2>r;r++){r?(e=this.fs,t=this.attrs.fs):(e=this.vs,t=this.attrs.vs);for(var n=e.attrs.length-1;n>=0;n--){var a=e.attrs[n],s=a[0];t.access[s]=t.access[s]||{};
var o=t.access[s];o.setFunction=Palette.Program.fetchSetter(this.context,a[1]),"vertexAttrib"==a[1]?(o.pointer=this.context.getAttribLocation(this.program,a[0]),this.context.enableVertexAttribArray(o.pointer),o.bufferName=a[2]):"buffer"==a[1]?(o.pointer=this.context.createBuffer(),o.itemSize=a[2]):o.pointer=this.context.getUniformLocation(this.program,a[0]),o.type=a[1]}}this.restoreDefaultConfig(Palette.Program.BOTH_MODE)},passAttrstoProg:function(){for(var e,t=0;2>t;t++){e=t?this.attrs.fs:this.attrs.vs;for(var r in e.access){var n=e.send[r],a=e.access[r];if("mat"==a.type.substr(0,3))a.setFunction(a.pointer,this.context.FALSE,n);else if("vertexAttrib"==a.type){var s=this.attrs.vs.access[a.bufferName];a.setFunction(a,s)}else"buffer"==a.type?a.setFunction(a,n):a.setFunction(a.pointer,n)}}},setDrawMode:function(e){this.drawMode=e},generateSend:function(e,t){var r;for(var n in e.access)r=t[n]?t[n]:e.store[n],e.send[n]=r}},Palette.Program.fetchSetter=function(e,t){var r,n=function(e){return function(t,r){e(t,r[0])}},a=function(e){return function(t,r){e(t,r[0],r[1])}},s=function(e){return function(t,r){e(t,r[0],r[1],r[2])}},o=function(e){return function(t,r){e(t,r[0],r[1],r[2],r[3])}};switch(t){case"float":return n(e.uniform1f.bind(e));case"float[]":return e.uniform1fv.bind(e);case"int":return n(e.uniform1i.bind(e));case"int[]":return e.uniform1iv.bind(e);case"vec2":return a(e.uniform2f.bind(e));case"vec2[]":return e.uniform2fv.bind(e);case"ivec2":return a(e.uniform2i.bind(e));case"ivec2[]":return e.uniform2iv.bind(e);case"vec3":return s(e.uniform3f.bind(e));case"vec3[]":return e.uniform3fv.bind(e);case"ivec3":return s(e.uniform3i.bind(e));case"ivec3[]":return e.uniform3iv.bind(e);case"vec4":return o(e.uniform4f.bind(e));case"vec4[]":return e.uniform4fv.bind(e);case"ivec4":return o(e.uniform4i.bind(e));case"ivec4[]":return e.uniform4iv.bind(e);case"mat2":return e.uniformMatrix2fv.bind(e);case"mat3":return e.uniformMatrix3fv.bind(e);case"mat4":return e.uniformMatrix4fv.bind(e);case"texture":return alert("You're on your own, kid."),null;case"vertexAttrib":return r=function(t,r){e.bindBuffer(e.ARRAY_BUFFER,r.pointer),e.vertexAttribPointer(t.pointer,r.itemSize,e.FLOAT,!1,0,0)},r.bind(e);case"buffer":return r=function(t,r){e.bindBuffer(e.ARRAY_BUFFER,t.pointer),e.bufferData(e.ARRAY_BUFFER,r,e.DYNAMIC_DRAW)},r.bind(e);default:return alert("Not gonna lie - you really messed up. I can't pass "+t+" onto the shader."),null}},Palette.Program.NONE_MODE=0,Palette.Program.VS_MODE=1,Palette.Program.FS_MODE=2,Palette.Program.BOTH_MODE=3,Palette.Program.POINTS=0,Palette.Program.LINES=1,Palette.Program.LINE_LOOP=2,Palette.Program.LINE_STRIP=3,Palette.Program.TRIANGLES=4,Palette.Program.TRIANGLE_STRIP=5,Palette.Program.TRIANGLE_FAN=6,Palette.Program.POLYGON=7,Palette.Program.prototype.constructor=Palette.Program,Palette.Shader=function(e,t,r,n,a){this.name=t,this.type=r,this.context=e,this.attrs=a,this.shader=null,this.compiled=!1,this.bakeShader(n)},Palette.Shader.prototype={bakeShader:function(e){if(this.compiled)return null;switch(this.compiled=!0,this.type){case Palette.Shader.VS:this.shader=this.context.createShader(this.context.VERTEX_SHADER);break;case Palette.Shader.FS:this.shader=this.context.createShader(this.context.FRAGMENT_SHADER);break;default:return!1}return this.context.shaderSource(this.shader,e),this.context.compileShader(this.shader),this.context.getShaderParameter(this.shader,this.context.COMPILE_STATUS)?!0:(alert("An error occurred compiling the shaders: "+this.context.getShaderInfoLog(this.shader)),!1)}},Palette.Shader.VS=0,Palette.Shader.FS=1,Palette.Shader.LIST=2,Palette.Shader.prototype.constructor=Palette.Shader,Palette.ShaderFactory=function(e){this.that=this,this.manager=e,this.downloadInProgress=!1},Palette.ShaderFactory.prototype={addShader:function(e){var t,r;switch(this.establishType(e)){case Palette.ShaderFactory.SOURCE_OBJECT:t=e;case Palette.ShaderFactory.JSON:t=t||JSON.parse(e),r=this.createShaderObject(t);break;case Palette.ShaderFactory.SHADER_OBJECT:r=e;break;case Palette.ShaderFactory.URL:this.downloadFromURL(e);break;default:throw new Error("Not a valid type of shader.")}r&&this.registerShader(r)},createShaderObject:function(e){switch(e.type){case Palette.Shader.VS:case Palette.Shader.FS:return new Palette.Shader(this.manager.context,e.name,e.type,e.src,e.attrs);case Palette.Shader.LIST:for(var t=e.content.length-1;t>=0;t--)this.addShader(e.content[t]);break;default:throw new Error("Tried to create an illegal class of shader.")}},downloadFromURL:function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.onload=function(){console.log(that),that.addShader(t.response),that.downloadInProgress=!1},that.downloadInProgress=!0,t.send()},establishType:function(e){var t=-1;return e instanceof Palette.Shader?t=Palette.ShaderFactory.SHADER_OBJECT:void 0!=e.type&&void 0!=e.name&&(e.content||e.src)?t=Palette.ShaderFactory.SOURCE_OBJECT:this.isJSON(e)?t=Palette.ShaderFactory.JSON:console.log("PALETTE: BAD SHADER. MALFORMED JSON OR BAD OBJECT SHAPE."),t},isJSON:function(e){try{return JSON.parse(e),!0}catch(t){return!1}},isString:function(e){return"string"==typeof e||e instanceof String},registerShader:function(e){switch(e.type){case Palette.Shader.VS:this.manager.vertShaders[e.name]=this.manager.vertShaders[e.name]||e;break;case Palette.Shader.FS:this.manager.fragShaders[e.name]=this.manager.fragShaders[e.name]||e;break;default:throw new Error("Tried to register an illegal class of shader.")}}},Palette.ShaderFactory.SOURCE_OBJECT=0,Palette.ShaderFactory.JSON=1,Palette.ShaderFactory.URL=2,Palette.ShaderFactory.SHADER_OBJECT=3,Palette.ShaderFactory.prototype.constructor=Palette.ShaderFactory,module.exports=earcut;